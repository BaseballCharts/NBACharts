<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NBA Stats Explorer</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(to bottom right, #f8fafc, #dbeafe);
            min-height: 100vh;
            padding: 1rem;
        }
        #root { max-width: 1400px; margin: 0 auto; }
        .chart-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 1.5rem;
        }
        .header-section {
            margin-bottom: 1.5rem;
        }
        .filters-row {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: end;
            margin-bottom: 1rem;
        }
        h1 {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }
        .subtitle {
            font-size: 0.875rem;
            color: #6b7280;
        }
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        label {
            font-size: 0.75rem;
            font-weight: 600;
            color: #4b5563;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }
        select {
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.875rem;
            background: white;
            cursor: pointer;
            min-width: 140px;
        }
        select:focus { outline: none; border-color: #3b82f6; }
        .comparison-filter {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .comparison-filter select {
            min-width: 60px;
        }
        .comparison-filter input {
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.875rem;
            width: 80px;
        }
        input[type="text"] {
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.875rem;
            min-width: 200px;
        }
        input[type="text"]:focus {
            outline: none;
            border-color: #3b82f6;
        }
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        .checkbox-group label {
            text-transform: none;
            font-size: 0.875rem;
            cursor: pointer;
        }
        .player-search-container {
            position: relative;
            min-width: 200px;
        }
        .player-search-input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.875rem;
        }
        .player-search-input:focus {
            outline: none;
            border-color: #3b82f6;
        }
        .player-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            max-height: 300px;
            overflow-y: auto;
            background: white;
            border: 1px solid #d1d5db;
            border-top: none;
            border-radius: 0 0 6px 6px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        .player-option {
            padding: 0.5rem;
            cursor: pointer;
            font-size: 0.875rem;
        }
        .player-option:hover {
            background: #f3f4f6;
        }
        .player-option.selected {
            background: #dbeafe;
            font-weight: 600;
        }
        button {
            padding: 0.5rem 1rem;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }
        button:hover { background: #dc2626; }
        .chart-wrapper {
            position: relative;
            width: 100%;
            overflow-x: auto;
        }
        svg { display: block; }
        .tooltip {
            position: fixed;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 0.75rem;
            border-radius: 6px;
            font-size: 0.875rem;
            pointer-events: none;
            z-index: 1000;
            max-width: 250px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        .tooltip div {
            margin: 0.25rem 0;
        }
        .tooltip-player {
            font-weight: bold;
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }
        .source {
            position: absolute;
            font-size: 11px;
            color: #6b7280;
            bottom: 10px;
            left: 60px;
        }
        .loading {
            text-align: center;
            padding: 3rem;
            color: #6b7280;
            font-size: 1.125rem;
        }
        .error {
            text-align: center;
            padding: 3rem;
            color: #ef4444;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        function StatsChart() {
            const [data, setData] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            
            const [xStat, setXStat] = useState('Off Win Shares');
            const [yStat, setYStat] = useState('Def Win Shares');
            const [bubbleStat, setBubbleStat] = useState('Win Shares');
            const [seasonFilter, setSeasonFilter] = useState('All');
            const [teamFilter, setTeamFilter] = useState('All');
            const [posFilter, setPosFilter] = useState('All');
            const [minGames, setMinGames] = useState(20);
            const [comparisonOperator, setComparisonOperator] = useState('>=');
            const [comparisonValue, setComparisonValue] = useState('');
            const [comparisonStat] = useState('Minutes Per Game');
            
            const [hoveredPlayer, setHoveredPlayer] = useState(null);
            const [mousePos, setMousePos] = useState({ x: 0, y: 0 });
            
            const [playerSearchQuery, setPlayerSearchQuery] = useState('');
            const [selectedPlayer, setSelectedPlayer] = useState(null);
            const [showPlayerDropdown, setShowPlayerDropdown] = useState(false);
            const [showLabels, setShowLabels] = useState(false);

            const width = 1200;
            const height = 700;
            const margin = { top: 30, right: 30, bottom: 60, left: 60 };

            useEffect(() => {
                Papa.parse('https://docs.google.com/spreadsheets/d/11wAoaz2NZsnmzGxw_kcaqDd-PbFrkf7hD6LyjKzDnhE/export?format=csv&gid=0', {
                    download: true,
                    header: true,
                    complete: (results) => {
                        const processedData = results.data
                            .filter(d => d.Player && d.Season)
                            .map(d => ({
                                // Keep original column names exactly as they appear in the sheet
                                ...d,
                                // Convert string numbers to actual numbers for all numeric columns
                                Age: parseFloat(d.Age) || 0,
                                Games: parseFloat(d.G) || parseFloat(d.Games) || 0,
                                'Games Started': parseFloat(d.GS) || parseFloat(d['Games Started']) || 0,
                                'Minutes Played': parseFloat(d.MP) || parseFloat(d['Minutes Played']) || 0,
                                'Field Goals': parseFloat(d.FG) || parseFloat(d['Field Goals']) || 0,
                                'Field Goal Attempts': parseFloat(d.FGA) || parseFloat(d['Field Goal Attempts']) || 0,
                                'Field Goal Percentage': parseFloat(d['FG%']) || parseFloat(d['Field Goal Percentage']) || 0,
                                '3-Point Field Goals': parseFloat(d['3P']) || parseFloat(d['3-Point Field Goals']) || 0,
                                '3-Point Field Goal Attempts': parseFloat(d['3PA']) || parseFloat(d['3-Point Field Goal Attempts']) || 0,
                                '3-Point Field Goal Percentage': parseFloat(d['3P%']) || parseFloat(d['3-Point Field Goal Percentage']) || 0,
                                '2-Point Field Goals': parseFloat(d['2P']) || parseFloat(d['2-Point Field Goals']) || 0,
                                '2-Point Field Goal Attempts': parseFloat(d['2PA']) || parseFloat(d['2-Point Field Goal Attempts']) || 0,
                                '2-Point Field Goal Percentage': parseFloat(d['2P%']) || parseFloat(d['2-Point Field Goal Percentage']) || 0,
                                'Effective Field Goal Percentage': parseFloat(d['eFG%']) || parseFloat(d['Effective Field Goal Percentage']) || 0,
                                'Free Throws': parseFloat(d.FT) || parseFloat(d['Free Throws']) || 0,
                                'Free Throw Attempts': parseFloat(d.FTA) || parseFloat(d['Free Throw Attempts']) || 0,
                                'Free Throw Percentage': parseFloat(d['FT%']) || parseFloat(d['Free Throw Percentage']) || 0,
                                'Offensive Rebounds': parseFloat(d.ORB) || parseFloat(d['Offensive Rebounds']) || 0,
                                'Defensive Rebounds': parseFloat(d.DRB) || parseFloat(d['Defensive Rebounds']) || 0,
                                'Total Rebounds': parseFloat(d.TRB) || parseFloat(d['Total Rebounds']) || 0,
                                Assists: parseFloat(d.AST) || parseFloat(d.Assists) || 0,
                                Steals: parseFloat(d.STL) || parseFloat(d.Steals) || 0,
                                Blocks: parseFloat(d.BLK) || parseFloat(d.Blocks) || 0,
                                Turnovers: parseFloat(d.TOV) || parseFloat(d.Turnovers) || 0,
                                'Personal Fouls': parseFloat(d.PF) || parseFloat(d['Personal Fouls']) || 0,
                                Points: parseFloat(d.PTS) || parseFloat(d.Points) || 0,
                                'Minutes Per Game': parseFloat(d.MPG) || parseFloat(d['Minutes Per Game']) || (parseFloat(d.MP) / (parseFloat(d.G) || 1)),
                                'Points Per Game': parseFloat(d.PPG) || parseFloat(d['Points Per Game']) || (parseFloat(d.PTS) / (parseFloat(d.G) || 1)),
                                'Rebounds Per Game': parseFloat(d.RPG) || parseFloat(d['Rebounds Per Game']) || (parseFloat(d.TRB) / (parseFloat(d.G) || 1)),
                                'Assists Per Game': parseFloat(d.APG) || parseFloat(d['Assists Per Game']) || (parseFloat(d.AST) / (parseFloat(d.G) || 1)),
                                'Steals Per Game': parseFloat(d.SPG) || parseFloat(d['Steals Per Game']) || (parseFloat(d.STL) / (parseFloat(d.G) || 1)),
                                'Blocks Per Game': parseFloat(d.BPG) || parseFloat(d['Blocks Per Game']) || (parseFloat(d.BLK) / (parseFloat(d.G) || 1)),
                                'Turnovers Per Game': parseFloat(d.TPG) || parseFloat(d['Turnovers Per Game']) || (parseFloat(d.TOV) / (parseFloat(d.G) || 1)),
                                'Player Efficiency Rating': parseFloat(d.PER) || parseFloat(d['Player Efficiency Rating']) || 0,
                                'True Shooting Percentage': parseFloat(d['TS%']) || parseFloat(d['True Shooting Percentage']) || 0,
                                '3-Point Attempt Rate': parseFloat(d['3PAr']) || parseFloat(d['3-Point Attempt Rate']) || 0,
                                'Free Throw Attempt Rate': parseFloat(d.FTr) || parseFloat(d['Free Throw Attempt Rate']) || 0,
                                'Offensive Rebound Percentage': parseFloat(d['ORB%']) || parseFloat(d['Offensive Rebound Percentage']) || 0,
                                'Defensive Rebound Percentage': parseFloat(d['DRB%']) || parseFloat(d['Defensive Rebound Percentage']) || 0,
                                'Total Rebound Percentage': parseFloat(d['TRB%']) || parseFloat(d['Total Rebound Percentage']) || 0,
                                'Assist Percentage': parseFloat(d['AST%']) || parseFloat(d['Assist Percentage']) || 0,
                                'Steal Percentage': parseFloat(d['STL%']) || parseFloat(d['Steal Percentage']) || 0,
                                'Block Percentage': parseFloat(d['BLK%']) || parseFloat(d['Block Percentage']) || 0,
                                'Turnover Percentage': parseFloat(d['TOV%']) || parseFloat(d['Turnover Percentage']) || 0,
                                'Usage Percentage': parseFloat(d['USG%']) || parseFloat(d['Usage Percentage']) || 0,
                                'Off Win Shares': parseFloat(d.OWS) || parseFloat(d['Off Win Shares']) || 0,
                                'Def Win Shares': parseFloat(d.DWS) || parseFloat(d['Def Win Shares']) || 0,
                                'Win Shares': parseFloat(d.WS) || parseFloat(d['Win Shares']) || 0,
                                'Win Shares Per 48 Minutes': parseFloat(d['WS/48']) || parseFloat(d['Win Shares Per 48 Minutes']) || 0,
                                'Offensive Box Plus/Minus': parseFloat(d.OBPM) || parseFloat(d['Offensive Box Plus/Minus']) || 0,
                                'Defensive Box Plus/Minus': parseFloat(d.DBPM) || parseFloat(d['Defensive Box Plus/Minus']) || 0,
                                'Box Plus/Minus': parseFloat(d.BPM) || parseFloat(d['Box Plus/Minus']) || 0,
                                'Value Over Replacement Player': parseFloat(d.VORP) || parseFloat(d['Value Over Replacement Player']) || 0,
                                // Keep Tm/Team field
                                Team: d.Tm || d.Team || 'N/A',
                                Pos: d.Pos || 'N/A'
                            }))
                            .filter(d => d.Games > 0);
                        setData(processedData);
                        setLoading(false);
                    },
                    error: (err) => {
                        setError(`Failed to load data: ${err.message}`);
                        setLoading(false);
                    }
                });
            }, []);

            const seasons = useMemo(() => {
                const uniqueSeasons = [...new Set(data.map(d => d.Season))].sort().reverse();
                return ['All', ...uniqueSeasons];
            }, [data]);

            const teams = useMemo(() => {
                const uniqueTeams = [...new Set(data.map(d => d.Team))].sort();
                return ['All', ...uniqueTeams];
            }, [data]);

            const positions = useMemo(() => {
                const uniquePos = [...new Set(data.map(d => d.Pos))].sort();
                return ['All', ...uniquePos];
            }, [data]);

            const stats = [
                'Age', 'Games', 'Games Started', 'Minutes Played', 
                'Field Goals', 'Field Goal Attempts', 'Field Goal Percentage',
                '3-Point Field Goals', '3-Point Field Goal Attempts', '3-Point Field Goal Percentage',
                '2-Point Field Goals', '2-Point Field Goal Attempts', '2-Point Field Goal Percentage',
                'Effective Field Goal Percentage',
                'Free Throws', 'Free Throw Attempts', 'Free Throw Percentage',
                'Offensive Rebounds', 'Defensive Rebounds', 'Total Rebounds',
                'Assists', 'Steals', 'Blocks', 'Turnovers', 'Personal Fouls', 'Points',
                'Minutes Per Game', 'Points Per Game', 'Rebounds Per Game', 
                'Assists Per Game', 'Steals Per Game', 'Blocks Per Game', 'Turnovers Per Game',
                'Player Efficiency Rating', 'True Shooting Percentage', 
                '3-Point Attempt Rate', 'Free Throw Attempt Rate',
                'Offensive Rebound Percentage', 'Defensive Rebound Percentage', 'Total Rebound Percentage',
                'Assist Percentage', 'Steal Percentage', 'Block Percentage', 
                'Turnover Percentage', 'Usage Percentage',
                'Off Win Shares', 'Def Win Shares', 'Win Shares', 'Win Shares Per 48 Minutes',
                'Offensive Box Plus/Minus', 'Defensive Box Plus/Minus', 'Box Plus/Minus',
                'Value Over Replacement Player'
            ];

            const filteredPlayers = useMemo(() => {
                return data.filter(player => {
                    if (seasonFilter !== 'All' && player.Season !== seasonFilter) return false;
                    if (teamFilter !== 'All' && player.Team !== teamFilter) return false;
                    if (posFilter !== 'All' && player.Pos !== posFilter) return false;
                    if (player.Games < minGames) return false;
                    
                    if (comparisonValue !== '') {
                        const value = parseFloat(comparisonValue);
                        const playerValue = player[comparisonStat] || 0;
                        switch(comparisonOperator) {
                            case '>': if (playerValue <= value) return false; break;
                            case '<': if (playerValue >= value) return false; break;
                            case '>=': if (playerValue < value) return false; break;
                            case '<=': if (playerValue > value) return false; break;
                            case '==': if (Math.abs(playerValue - value) > 0.01) return false; break;
                        }
                    }
                    
                    if (selectedPlayer && player.Player !== selectedPlayer) return false;
                    
                    return true;
                });
            }, [data, seasonFilter, teamFilter, posFilter, minGames, comparisonOperator, comparisonValue, comparisonStat, selectedPlayer]);

            const searchedPlayers = useMemo(() => {
                if (!playerSearchQuery) return [];
                return data
                    .filter(p => p.Player.toLowerCase().includes(playerSearchQuery.toLowerCase()))
                    .reduce((acc, player) => {
                        if (!acc.find(p => p.Player === player.Player)) {
                            acc.push(player);
                        }
                        return acc;
                    }, [])
                    .slice(0, 20);
            }, [data, playerSearchQuery]);

            const xExtent = useMemo(() => {
                const values = filteredPlayers.map(d => d[xStat] || 0);
                return [Math.min(...values), Math.max(...values)];
            }, [filteredPlayers, xStat]);

            const yExtent = useMemo(() => {
                const values = filteredPlayers.map(d => d[yStat] || 0);
                return [Math.min(...values), Math.max(...values)];
            }, [filteredPlayers, yStat]);

            const bubbleExtent = useMemo(() => {
                const values = filteredPlayers.map(d => d[bubbleStat] || 0);
                return [Math.min(...values), Math.max(...values)];
            }, [filteredPlayers, bubbleStat]);

            const xScale = (value) => {
                const [min, max] = xExtent;
                const range = max - min || 1;
                return margin.left + ((value - min) / range) * (width - margin.left - margin.right);
            };

            const yScale = (value) => {
                const [min, max] = yExtent;
                const range = max - min || 1;
                return height - margin.bottom - ((value - min) / range) * (height - margin.top - margin.bottom);
            };

            const sizeScale = (value) => {
                const [min, max] = bubbleExtent;
                const range = max - min || 1;
                return 3 + ((value - min) / range) * 12;
            };

            const xTicks = useMemo(() => {
                const [min, max] = xExtent;
                const range = max - min;
                const step = range / 5;
                return Array.from({ length: 6 }, (_, i) => min + step * i);
            }, [xExtent]);

            const yTicks = useMemo(() => {
                const [min, max] = yExtent;
                const range = max - min;
                const step = range / 5;
                return Array.from({ length: 6 }, (_, i) => min + step * i);
            }, [yExtent]);

            const formatStatValue = (stat, value, isAxis = false) => {
                // Percentage stats
                if (stat.includes('Percentage') || stat.includes('Rate')) {
                    return isAxis ? value.toFixed(1) : value.toFixed(3);
                }
                // Counting stats that should be integers
                if (['Age', 'Games', 'Games Started', 'Minutes Played',
                     'Field Goals', 'Field Goal Attempts', '3-Point Field Goals', '3-Point Field Goal Attempts',
                     '2-Point Field Goals', '2-Point Field Goal Attempts', 'Free Throws', 'Free Throw Attempts',
                     'Offensive Rebounds', 'Defensive Rebounds', 'Total Rebounds', 
                     'Assists', 'Steals', 'Blocks', 'Turnovers', 'Personal Fouls', 'Points'].includes(stat)) {
                    return Math.round(value);
                }
                // Per-game stats and advanced metrics
                return value.toFixed(1);
            };

            const resetFilters = () => {
                setXStat('Off Win Shares');
                setYStat('Def Win Shares');
                setBubbleStat('Win Shares');
                setSeasonFilter('All');
                setTeamFilter('All');
                setPosFilter('All');
                setMinGames(20);
                setComparisonOperator('>=');
                setComparisonValue('');
                setPlayerSearchQuery('');
                setSelectedPlayer(null);
                setShowLabels(false);
            };

            if (loading) return <div className="loading">Loading NBA data...</div>;
            if (error) return <div className="error">{error}</div>;

            return (
            <div className="chart-container">
                <div className="header-section">
                    <h1>NBA Stats Explorer</h1>
                    <div className="subtitle">
                        Showing {filteredPlayers.length} players
                    </div>
                </div>

                <div className="filters-row">
                    <div className="filter-group">
                        <label>X-Axis</label>
                        <select value={xStat} onChange={(e) => setXStat(e.target.value)}>
                            {stats.map(stat => <option key={stat} value={stat}>{stat}</option>)}
                        </select>
                    </div>
                    
                    <div className="filter-group">
                        <label>Y-Axis</label>
                        <select value={yStat} onChange={(e) => setYStat(e.target.value)}>
                            {stats.map(stat => <option key={stat} value={stat}>{stat}</option>)}
                        </select>
                    </div>
                    
                    <div className="filter-group">
                        <label>Bubble Size</label>
                        <select value={bubbleStat} onChange={(e) => setBubbleStat(e.target.value)}>
                            {stats.map(stat => <option key={stat} value={stat}>{stat}</option>)}
                        </select>
                    </div>

                    <div className="filter-group">
                        <label>Season</label>
                        <select value={seasonFilter} onChange={(e) => setSeasonFilter(e.target.value)}>
                            {seasons.map(season => <option key={season} value={season}>{season}</option>)}
                        </select>
                    </div>

                    <div className="filter-group">
                        <label>Team</label>
                        <select value={teamFilter} onChange={(e) => setTeamFilter(e.target.value)}>
                            {teams.map(team => <option key={team} value={team}>{team}</option>)}
                        </select>
                    </div>

                    <div className="filter-group">
                        <label>Position</label>
                        <select value={posFilter} onChange={(e) => setPosFilter(e.target.value)}>
                            {positions.map(pos => <option key={pos} value={pos}>{pos}</option>)}
                        </select>
                    </div>
                </div>

                <div className="filters-row">
                    <div className="filter-group">
                        <label>Min Games</label>
                        <input 
                            type="text" 
                            value={minGames} 
                            onChange={(e) => setMinGames(parseInt(e.target.value) || 0)}
                            style={{ width: '80px' }}
                        />
                    </div>

                    <div className="filter-group">
                        <label>Filter by Minutes Per Game</label>
                        <div className="comparison-filter">
                            <select value={comparisonOperator} onChange={(e) => setComparisonOperator(e.target.value)}>
                                <option value=">=">&gt;=</option>
                                <option value=">">&gt;</option>
                                <option value="<=">&lt;=</option>
                                <option value="<">&lt;</option>
                                <option value="==">==</option>
                            </select>
                            <input 
                                type="text"
                                placeholder="Value"
                                value={comparisonValue}
                                onChange={(e) => setComparisonValue(e.target.value)}
                            />
                        </div>
                    </div>

                    <div className="filter-group">
                        <label>Search Player</label>
                        <div className="player-search-container">
                            <input
                                type="text"
                                className="player-search-input"
                                placeholder="Type player name..."
                                value={playerSearchQuery}
                                onChange={(e) => {
                                    setPlayerSearchQuery(e.target.value);
                                    setShowPlayerDropdown(true);
                                    if (!e.target.value) setSelectedPlayer(null);
                                }}
                                onFocus={() => setShowPlayerDropdown(true)}
                            />
                            {showPlayerDropdown && searchedPlayers.length > 0 && (
                                <div className="player-dropdown">
                                    {searchedPlayers.map((player, idx) => (
                                        <div 
                                            key={idx}
                                            className={`player-option ${selectedPlayer === player.Player ? 'selected' : ''}`}
                                            onClick={() => {
                                                setSelectedPlayer(player.Player);
                                                setPlayerSearchQuery(player.Player);
                                                setShowPlayerDropdown(false);
                                            }}
                                        >
                                            {player.Player} ({player.Team})
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>
                    <div className="filter-group">
                        <label>&nbsp;</label>
                        <div className="checkbox-group">
                            <input 
                                type="checkbox"
                                id="showLabels"
                                checked={showLabels}
                                onChange={(e) => setShowLabels(e.target.checked)}
                            />
                            <label htmlFor="showLabels">Show player labels</label>
                        </div>
                    </div>
                </div>

                <div className="filters-row">
                    <button onClick={resetFilters}>Reset</button>
                </div>

                <div className="chart-wrapper">
                    <svg 
                        width={width} 
                        height={height}
                        onMouseMove={(e) => setMousePos({ x: e.clientX, y: e.clientY })}
                    >
                        {xTicks.map(tick => (
                            <line
                                key={`x-grid-${tick}`}
                                x1={xScale(tick)}
                                y1={margin.top}
                                x2={xScale(tick)}
                                y2={height - margin.bottom}
                                stroke="#e5e7eb"
                                strokeWidth="1"
                            />
                        ))}
                        {yTicks.map(tick => (
                            <line
                                key={`y-grid-${tick}`}
                                x1={margin.left}
                                y1={yScale(tick)}
                                x2={width - margin.right}
                                y2={yScale(tick)}
                                stroke="#e5e7eb"
                                strokeWidth="1"
                            />
                        ))}

                        <line
                            x1={margin.left}
                            y1={height - margin.bottom}
                            x2={width - margin.right}
                            y2={height - margin.bottom}
                            stroke="#374151"
                            strokeWidth="2"
                        />
                        <line
                            x1={margin.left}
                            y1={margin.top}
                            x2={margin.left}
                            y2={height - margin.bottom}
                            stroke="#374151"
                            strokeWidth="2"
                        />

                        {xTicks.map(tick => (
                            <g key={`x-tick-${tick}`}>
                                <line
                                    x1={xScale(tick)}
                                    y1={height - margin.bottom}
                                    x2={xScale(tick)}
                                    y2={height - margin.bottom + 6}
                                    stroke="#374151"
                                    strokeWidth="2"
                                />
                                <text
                                    x={xScale(tick)}
                                    y={height - margin.bottom + 20}
                                    textAnchor="middle"
                                    fontSize="12"
                                    fill="#6b7280"
                                >
                                    {formatStatValue(xStat, tick, true)}
                                </text>
                            </g>
                        ))}

                        {yTicks.map(tick => (
                            <g key={`y-tick-${tick}`}>
                                <line
                                    x1={margin.left - 6}
                                    y1={yScale(tick)}
                                    x2={margin.left}
                                    y2={yScale(tick)}
                                    stroke="#374151"
                                    strokeWidth="2"
                                />
                                <text
                                    x={margin.left - 10}
                                    y={yScale(tick)}
                                    textAnchor="end"
                                    dominantBaseline="middle"
                                    fontSize="12"
                                    fill="#6b7280"
                                >
                                    {formatStatValue(yStat, tick, true)}
                                </text>
                            </g>
                        ))}

                        <text
                            x={width / 2}
                            y={height - 10}
                            textAnchor="middle"
                            fontSize="14"
                            fontWeight="600"
                            fill="#374151"
                        >
                            {xStat}
                        </text>
                        <text
                            x={-height / 2}
                            y={15}
                            textAnchor="middle"
                            fontSize="14"
                            fontWeight="600"
                            fill="#374151"
                            transform={`rotate(-90)`}
                        >
                            {yStat}
                        </text>

                        {filteredPlayers.map((player, i) => {
                            const x = xScale(player[xStat] || 0);
                            const y = yScale(player[yStat] || 0);
                            const r = sizeScale(player[bubbleStat] || 0);
                            const isSelected = selectedPlayer === player.Player;
                            
                            return (
                                <g key={i}>
                                    <circle
                                        cx={x}
                                        cy={y}
                                        r={r}
                                        fill={isSelected ? "#ef4444" : "#3b82f6"}
                                        fillOpacity={isSelected ? "0.8" : "0.6"}
                                        stroke={isSelected ? "#dc2626" : "#2563eb"}
                                        strokeWidth={isSelected ? "2" : "1"}
                                        onMouseEnter={() => setHoveredPlayer(player)}
                                        onMouseLeave={() => setHoveredPlayer(null)}
                                        style={{ cursor: 'pointer' }}
                                    />
                                    {(showLabels || isSelected) && (
                                        <text
                                            x={x}
                                            y={y - r - 4}
                                            textAnchor="middle"
                                            fontSize="10"
                                            fontWeight={isSelected ? "700" : "500"}
                                            fill={isSelected ? "#ef4444" : "#1f2937"}
                                            pointerEvents="none"
                                        >
                                            {player.Player}
                                        </text>
                                    )}
                                </g>
                            );
                        })}
                    </svg>

                    {hoveredPlayer && (
                        <div 
                            className="tooltip"
                            style={{ 
                                left: mousePos.x + 15,
                                top: mousePos.y - 15
                            }}
                        >
                            <div className="tooltip-player">{hoveredPlayer.Player}</div>
                            <div>Team: {hoveredPlayer.Team}</div>
                            <div>Position: {hoveredPlayer.Pos}</div>
                            <div>Season: {hoveredPlayer.Season}</div>
                            <div>{bubbleStat}: {formatStatValue(bubbleStat, hoveredPlayer[bubbleStat] || 0)}</div>
                            <div>{xStat}: {formatStatValue(xStat, hoveredPlayer[xStat] || 0)}</div>
                            <div>{yStat}: {formatStatValue(yStat, hoveredPlayer[yStat] || 0)}</div>
                            <div>Games: {formatStatValue('Games', hoveredPlayer.Games || 0)}</div>
                            <div>MPG: {formatStatValue('Minutes Per Game', hoveredPlayer['Minutes Per Game'] || 0)}</div>
                        </div>
                    )}
                    
                    <div className="source">
                        Source: Basketball Reference
                    </div>
                </div>
            </div>
            );
        }

        ReactDOM.render(<StatsChart />, document.getElementById('root'));
    </script>
</body>
</html>
