<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2024-25 NBA Stats Explorer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .controls {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }

        .control-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
        }

        .control-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #495057;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .control-group select {
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1em;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-group select:hover {
            border-color: #667eea;
        }

        .control-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .filter-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .chart-container {
            padding: 30px;
            background: white;
        }

        #chart {
            width: 100%;
            height: 700px;
        }

        .stats-info {
            padding: 20px 30px;
            background: #f8f9fa;
            border-top: 2px solid #e9ecef;
            text-align: center;
            color: #6c757d;
            font-size: 0.9em;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2em;
            color: #667eea;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .control-grid {
                grid-template-columns: 1fr;
            }
            
            #chart {
                height: 500px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèÄ 2024-25 NBA Stats Explorer</h1>
            <p>Interactive visualization of player statistics</p>
        </div>

        <div class="controls">
            <div class="control-grid">
                <div class="control-group">
                    <label for="xAxis">X-Axis Stat</label>
                    <select id="xAxis">
                        <option value="OWS" selected>OWS - Offensive Win Shares</option>
                        <option value="DWS">DWS - Defensive Win Shares</option>
                        <option value="PTS">PTS - Points</option>
                        <option value="TRB">TRB - Total Rebounds</option>
                        <option value="AST">AST - Assists</option>
                        <option value="STL">STL - Steals</option>
                        <option value="BLK">BLK - Blocks</option>
                        <option value="FG%">FG% - Field Goal %</option>
                        <option value="3P%">3P% - 3-Point %</option>
                        <option value="FT%">FT% - Free Throw %</option>
                        <option value="TS%">TS% - True Shooting %</option>
                        <option value="PER">PER - Player Efficiency</option>
                        <option value="WS">WS - Win Shares</option>
                        <option value="BPM">BPM - Box Plus/Minus</option>
                        <option value="VORP">VORP - Value Over Replacement</option>
                    </select>
                </div>

                <div class="control-group">
                    <label for="yAxis">Y-Axis Stat</label>
                    <select id="yAxis">
                        <option value="DWS" selected>DWS - Defensive Win Shares</option>
                        <option value="OWS">OWS - Offensive Win Shares</option>
                        <option value="PTS">PTS - Points</option>
                        <option value="TRB">TRB - Total Rebounds</option>
                        <option value="AST">AST - Assists</option>
                        <option value="STL">STL - Steals</option>
                        <option value="BLK">BLK - Blocks</option>
                        <option value="FG%">FG% - Field Goal %</option>
                        <option value="3P%">3P% - 3-Point %</option>
                        <option value="FT%">FT% - Free Throw %</option>
                        <option value="TS%">TS% - True Shooting %</option>
                        <option value="PER">PER - Player Efficiency</option>
                        <option value="WS">WS - Win Shares</option>
                        <option value="BPM">BPM - Box Plus/Minus</option>
                        <option value="VORP">VORP - Value Over Replacement</option>
                    </select>
                </div>
            </div>

            <div class="filter-section">
                <div class="control-group">
                    <label for="seasonFilter">Season</label>
                    <select id="seasonFilter">
                        <option value="All">All Seasons</option>
                    </select>
                </div>

                <div class="control-group">
                    <label for="teamFilter">Team</label>
                    <select id="teamFilter">
                        <option value="All">All Teams</option>
                    </select>
                </div>

                <div class="control-group">
                    <label for="positionFilter">Position</label>
                    <select id="positionFilter">
                        <option value="All">All Positions</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="chart-container">
            <div id="loading" class="loading">Loading NBA stats data...</div>
            <div id="chart"></div>
        </div>

        <div class="stats-info">
            Data from 2024-25 NBA Season | Interactive Stats Explorer
        </div>
    </div>

    <script>
        let allData = [];
        const SHEET_URL = 'https://docs.google.com/spreadsheets/d/11wAoaz2NZsnmzGxw_kcaqDd-PbFrkf7hD6LyjKzDnhE/export?format=csv&gid=0';

        // Mapping column names to their positions
        const statColumns = {
            'Season': 0, 'Player': 1, 'Team': 2, 'Pos': 3,
            'G': 4, 'GS': 5, 'MP': 6, 'FG': 7, 'FGA': 8, 'FG%': 9,
            '3P': 10, '3PA': 11, '3P%': 12, '2P': 13, '2PA': 14, '2P%': 15,
            'eFG%': 16, 'FT': 17, 'FTA': 18, 'FT%': 19, 'ORB': 20, 'DRB': 21,
            'TRB': 22, 'AST': 23, 'STL': 24, 'BLK': 25, 'TOV': 26, 'PF': 27,
            'PTS': 28, 'PER': 29, 'TS%': 30, '3PAr': 31, 'FTr': 32, 'ORB%': 33,
            'DRB%': 34, 'TRB%': 35, 'AST%': 36, 'STL%': 37, 'BLK%': 38, 'TOV%': 39,
            'USG%': 40, 'OWS': 41, 'DWS': 42, 'WS': 43, 'WS/48': 44, 'OBPM': 45,
            'DBPM': 46, 'BPM': 47, 'VORP': 48
        };

        // Team colors
        const teamColors = {
            'ATL': '#E03A3E', 'BOS': '#007A33', 'BRK': '#000000', 'CHO': '#1D1160',
            'CHI': '#CE1141', 'CLE': '#860038', 'DAL': '#00538C', 'DEN': '#0E2240',
            'DET': '#C8102E', 'GSW': '#1D428A', 'HOU': '#CE1141', 'IND': '#002D62',
            'LAC': '#C8102E', 'LAL': '#552583', 'MEM': '#5D76A9', 'MIA': '#98002E',
            'MIL': '#00471B', 'MIN': '#0C2340', 'NOP': '#0C2340', 'NYK': '#006BB6',
            'OKC': '#007AC1', 'ORL': '#0077C0', 'PHI': '#006BB6', 'PHO': '#1D1160',
            'POR': '#E03A3E', 'SAC': '#5A2D81', 'SAS': '#C4CED4', 'TOR': '#CE1141',
            'UTA': '#002B5C', 'WAS': '#002B5C', '2TM': '#808080'
        };

        function parseValue(value) {
            if (value === '' || value === null || value === undefined) return null;
            const num = parseFloat(value);
            return isNaN(num) ? null : num;
        }

        function getStatValue(row, statName) {
            const index = statColumns[statName];
            if (index === undefined) return null;
            return parseValue(row[index]);
        }

        function loadData() {
            Papa.parse(SHEET_URL, {
                download: true,
                header: false,
                skipEmptyLines: true,
                complete: function(results) {
                    allData = results.data.slice(1); // Skip header row
                    populateFilters();
                    updateChart();
                    document.getElementById('loading').style.display = 'none';
                },
                error: function(error) {
                    console.error('Error loading data:', error);
                    document.getElementById('loading').innerHTML = 'Error loading data. Please try again.';
                }
            });
        }

        function populateFilters() {
            // Populate seasons
            const seasons = [...new Set(allData.map(row => row[0]))].filter(Boolean).sort().reverse();
            const seasonSelect = document.getElementById('seasonFilter');
            seasons.forEach(season => {
                const option = document.createElement('option');
                option.value = season;
                option.textContent = season;
                seasonSelect.appendChild(option);
            });

            // Populate teams
            const teams = [...new Set(allData.map(row => row[2]))].filter(Boolean).sort();
            const teamSelect = document.getElementById('teamFilter');
            teams.forEach(team => {
                const option = document.createElement('option');
                option.value = team;
                option.textContent = team;
                teamSelect.appendChild(option);
            });

            // Populate positions
            const positions = [...new Set(allData.map(row => row[3]))].filter(Boolean).sort();
            const positionSelect = document.getElementById('positionFilter');
            positions.forEach(pos => {
                const option = document.createElement('option');
                option.value = pos;
                option.textContent = pos;
                positionSelect.appendChild(option);
            });
        }

        function filterData() {
            const season = document.getElementById('seasonFilter').value;
            const team = document.getElementById('teamFilter').value;
            const position = document.getElementById('positionFilter').value;

            return allData.filter(row => {
                if (season !== 'All' && row[0] !== season) return false;
                if (team !== 'All' && row[2] !== team) return false;
                if (position !== 'All' && row[3] !== position) return false;
                return true;
            });
        }

        function updateChart() {
            const xStat = document.getElementById('xAxis').value;
            const yStat = document.getElementById('yAxis').value;
            const filteredData = filterData();

            const players = [];
            const xValues = [];
            const yValues = [];
            const sizes = [];
            const colors = [];
            const hoverText = [];

            filteredData.forEach(row => {
                const player = row[1];
                const team = row[2];
                const pos = row[3];
                const xVal = getStatValue(row, xStat);
                const yVal = getStatValue(row, yStat);
                const pts = getStatValue(row, 'PTS');

                if (xVal !== null && yVal !== null && player) {
                    players.push(player);
                    xValues.push(xVal);
                    yValues.push(yVal);
                    sizes.push(Math.max(pts * 2, 10));
                    colors.push(teamColors[team] || '#888888');
                    
                    hoverText.push(
                        `<b>${player}</b><br>` +
                        `Team: ${team} | Pos: ${pos}<br>` +
                        `${xStat}: ${xVal.toFixed(2)}<br>` +
                        `${yStat}: ${yVal.toFixed(2)}<br>` +
                        `PTS: ${pts ? pts.toFixed(1) : 'N/A'}`
                    );
                }
            });

            const trace = {
                x: xValues,
                y: yValues,
                mode: 'markers',
                type: 'scatter',
                text: players,
                hovertemplate: hoverText.map((_, i) => hoverText[i] + '<extra></extra>'),
                marker: {
                    size: sizes,
                    color: colors,
                    opacity: 0.7,
                    line: {
                        color: 'white',
                        width: 2
                    }
                }
            };

            const layout = {
                title: {
                    text: `${yStat} vs ${xStat}`,
                    font: {
                        size: 24,
                        family: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto',
                        color: '#2d3748'
                    }
                },
                xaxis: {
                    title: {
                        text: xStat,
                        font: { size: 16 }
                    },
                    gridcolor: '#e2e8f0',
                    showline: true,
                    linewidth: 2,
                    linecolor: '#cbd5e0'
                },
                yaxis: {
                    title: {
                        text: yStat,
                        font: { size: 16 }
                    },
                    gridcolor: '#e2e8f0',
                    showline: true,
                    linewidth: 2,
                    linecolor: '#cbd5e0'
                },
                hovermode: 'closest',
                plot_bgcolor: '#f7fafc',
                paper_bgcolor: 'white',
                margin: { t: 60, r: 30, b: 60, l: 60 },
                font: {
                    family: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto'
                }
            };

            const config = {
                responsive: true,
                displayModeBar: true,
                displaylogo: false,
                modeBarButtonsToRemove: ['lasso2d', 'select2d']
            };

            Plotly.newPlot('chart', [trace], layout, config);
        }

        // Event listeners
        document.getElementById('xAxis').addEventListener('change', updateChart);
        document.getElementById('yAxis').addEventListener('change', updateChart);
        document.getElementById('seasonFilter').addEventListener('change', updateChart);
        document.getElementById('teamFilter').addEventListener('change', updateChart);
        document.getElementById('positionFilter').addEventListener('change', updateChart);

        // Load data on page load
        loadData();
    </script>
</body>
</html>